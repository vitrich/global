{# templates/teacher/assignment_detail.html #}
{% extends 'base.html' %}

{% block title %}–†–∞–±–æ—Ç–∞: {{ assignment.title }}{% endblock %}

{% block content %}
<div class="container">
    <div class="py-5">
        <div class="row mb-5">
            <div class="col-lg-8">
                <h1 class="mb-2">{{ assignment.title }}</h1>
                <p class="text-muted mb-4">
                    {{ assignment.school_class }} ¬∑ {{ assignment.topic.name }}
                </p>
            </div>
            <div class="col-lg-4 text-end">
                <a href="{% url 'regenerate_variants' assignment.id %}" class="btn btn-warning">
                    üîÑ –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã
                </a>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∞—Å—Å—É -->
        <div class="card mb-5">
            <div class="card-header bg-light">
                <h5 class="mb-0">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <h6 class="text-muted">–£—á–µ–Ω–∏–∫–æ–≤</h6>
                        <h3>{{ stats.total_students }}</h3>
                    </div>
                    <div class="col-md-3">
                        <h6 class="text-muted">–û—Ç–ø—Ä–∞–≤–∏–ª–∏</h6>
                        <h3 class="text-success">{{ stats.submitted }}</h3>
                    </div>
                    <div class="col-md-3">
                        <h6 class="text-muted">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö</h6>
                        <h3>{{ stats.total_correct }}</h3>
                    </div>
                    <div class="col-md-3">
                        <h6 class="text-muted">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h6>
                        <h3>{{ stats.average_score|floatformat:1 }}%</h3>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —É—á–µ–Ω–∏–∫–∞–º -->
        <h3 class="mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —É—á–µ–Ω–∏–∫–∞–º</h3>
        
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>–£—á–µ–Ω–∏–∫</th>
                        <th>–í–∞—Ä–∏–∞–Ω—Ç</th>
                        <th>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</th>
                        <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in variant_data %}
                    <tr>
                        <td><strong>{{ item.student_name }}</strong></td>
                        <td>#{{ item.variant.variant_number }}</td>
                        <td>
                            {% if item.total > 0 %}
                                <span class="badge bg-success">{{ item.correct }} / {{ item.total }}</span>
                            {% else %}
                                <span class="text-muted">‚Äî</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.total > 0 %}
                                <strong style="color: {% if item.percent == 100 %}#28a745{% elif item.percent >= 70 %}#ffc107{% else %}#dc3545{% endif %};">
                                    {{ item.percent|floatformat:0 }}%
                                </strong>
                            {% else %}
                                <span class="text-muted">‚Äî</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.total == 0 %}
                                <span class="badge bg-secondary">–ù–µ –Ω–∞—á–∏–Ω–∞–ª</span>
                            {% elif item.percent == 100 %}
                                <span class="badge bg-success">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                            {% else %}
                                <span class="badge bg-warning">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'view_results' item.variant.id %}" class="btn btn-sm btn-outline-primary">
                                –ü—Ä–æ—Å–º–æ—Ç—Ä
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="mt-5">
            <a href="{% url 'teacher_dashboard' %}" class="btn btn-outline-secondary">
                ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
            </a>
        </div>
    </div>
</div>
{% endblock %}
